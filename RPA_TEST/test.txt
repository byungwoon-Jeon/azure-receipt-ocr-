# 1) 너무 작은/비정상 비율 제거
kept = []
img_area = (img_w * img_h) if (img_w and img_h) else None
removed_small = 0; removed_aspect = 0
for b in boxes:
    w = b[2]-b[0]; h = b[3]-b[1]
    if w <= 5 or h <= 5:
        removed_small += 1; continue
    if img_area and ((w*h) / img_area) < min_area_ratio:
        removed_small += 1; continue
    ar = h / (w + 1e-9)
    if not (aspect_min <= ar <= aspect_max):
        removed_aspect += 1; continue
    kept.append(b)

# 🔧 모두 사라지면 완화 파라미터로 즉시 재통과
if not kept:
    kept = []
    for b in boxes:
        w = b[2]-b[0]; h = b[3]-b[1]
        # 최소 픽셀 기준만 적용하고 면적/종횡비는 잠시 스킵
        if w <= 3 or h <= 3:
            continue
        kept.append(b)